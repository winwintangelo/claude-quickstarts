services:
  browser-tools-api:
    build:
      context: .
      args:
        DISPLAY_NUM: ${DISPLAY_NUM}
        HEIGHT: ${DISPLAY_HEIGHT}
        WIDTH: ${DISPLAY_WIDTH}
    image: browser-tools-api-demo:latest
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - DISPLAY_NUM=${DISPLAY_NUM}
      - HEIGHT=${DISPLAY_HEIGHT}
      - WIDTH=${DISPLAY_WIDTH}
      - BROWSER_WIDTH=${BROWSER_WIDTH}
      - BROWSER_HEIGHT=${BROWSER_HEIGHT}
    volumes:
      - ./validate_env.py:/home/browsertoolsapi/validate_env.py
      - ${HOME}/.anthropic:/home/browsertoolsapi/.anthropic
    ports:
      - "${VNC_PORT:-5900}:5900"  # VNC
      - "${STREAMLIT_PORT:-8501}:8501"  # Streamlit
      - "${NOVNC_PORT:-6080}:6080"  # noVNC
      - "${HTTP_PORT:-8080}:8080"  # HTTP server
    stdin_open: true
    tty: true
    env_file:
      - .env
    develop:
      watch:
        - path: ./browser_tools_api_demo
          action: sync+restart
          target: /home/browsertoolsapi/browser_tools_api_demo
        - path: ./validate_env.py
          action: rebuild
          target: /home/browsertoolsapi/validate_env.py